'''
This analysis system process all URI samples and find/create
 thier domain and submit the relation between them
'''


class URISamplesAnalysisInstance(AnalysisClient):

    def __init__(self, config):
        super().__init__(config)


    def analyze(self, scheduled_analysis):

        # Recieve new scheduled analysis from the mass sever
        # and fetch the malware sample from it
        sample = scheduled_analysis.get_sample()

        domain = getDomainOfURI(sample.uri)
        # Submit or get the domain sample
        sampleDomain = mass_api_client.resources.DomainSample.\
            create(domain)

        # Create the relation between the domain and
        # the sample URI
        mass_api_client.resources.ResolvedBySampleRelation.\
            create(sampleDomain, sample)

        # submit a report
        self.submit_report(
            scheduled_analysis,
            json_report_objects={'domain_report':
                                     {'domain_url': sampleDomain.url}},
        )
