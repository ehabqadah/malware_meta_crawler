\begin{Verbatim}[commandchars=\\\{\}]
\PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{l+s+sd}{This analysis system process all URI samples and find/create}
\PYG{l+s+sd}{ thier domain and submit the relation between them}
\PYG{l+s+sd}{\PYGZsq{}\PYGZsq{}\PYGZsq{}}
\PYG{k}{class} \PYG{n+nc}{URISamplesAnalysisInstance}\PYG{p}{(}\PYG{n}{AnalysisClient}\PYG{p}{):}

    \PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{config}\PYG{p}{):}
        \PYG{n+nb}{super}\PYG{p}{()}\PYG{o}{.}\PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n}{config}\PYG{p}{)}


    \PYG{k}{def} \PYG{n+nf}{analyze}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{scheduled\PYGZus{}analysis}\PYG{p}{):}

        \PYG{c+c1}{\PYGZsh{} Recieve new scheduled analysis from the mass sever}
        \PYG{c+c1}{\PYGZsh{} and fetch the malware sample from it}
        \PYG{n}{sample} \PYG{o}{=} \PYG{n}{scheduled\PYGZus{}analysis}\PYG{o}{.}\PYG{n}{get\PYGZus{}sample}\PYG{p}{()}

        \PYG{n}{domain} \PYG{o}{=} \PYG{n}{getDomainOfURI}\PYG{p}{(}\PYG{n}{sample}\PYG{o}{.}\PYG{n}{uri}\PYG{p}{)}
        \PYG{c+c1}{\PYGZsh{} Submit or get the domain sample}
        \PYG{n}{sampleDomain} \PYG{o}{=} \PYG{n}{mass\PYGZus{}api\PYGZus{}client}\PYG{o}{.}\PYG{n}{resources}\PYG{o}{.}\PYG{n}{DomainSample}\PYG{o}{.}\PYGZbs{}
            \PYG{n}{create}\PYG{p}{(}\PYG{n}{domain}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} Create the relation between the domain and}
        \PYG{c+c1}{\PYGZsh{} the sample URI}
        \PYG{n}{mass\PYGZus{}api\PYGZus{}client}\PYG{o}{.}\PYG{n}{resources}\PYG{o}{.}\PYG{n}{ResolvedBySampleRelation}\PYG{o}{.}\PYGZbs{}
            \PYG{n}{create}\PYG{p}{(}\PYG{n}{sampleDomain}\PYG{p}{,} \PYG{n}{sample}\PYG{p}{)}

        \PYG{c+c1}{\PYGZsh{} submit a report}
        \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{submit\PYGZus{}report}\PYG{p}{(}
            \PYG{n}{scheduled\PYGZus{}analysis}\PYG{p}{,}
            \PYG{n}{json\PYGZus{}report\PYGZus{}objects}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}domain\PYGZus{}report\PYGZsq{}}\PYG{p}{:}
                                     \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}domain\PYGZus{}url\PYGZsq{}}\PYG{p}{:} \PYG{n}{sampleDomain}\PYG{o}{.}\PYG{n}{url}\PYG{p}{\PYGZcb{}\PYGZcb{},}
        \PYG{p}{)}
\end{Verbatim}
